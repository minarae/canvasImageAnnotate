<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Canvas Area Draw</title>
    <link rel="stylesheet" href="./resources/css/jquery.canvasArea.css" type="text/css" />
</head>

<body>
    <div id="main" class="container">
        <h4>Image Annotation System based on canvas</h4>
        <canvas id="viewport"></canvas>
        <canvas id="canvasOutput" style="display:none;"></canvas>
        <br/>
        <input type="file" id="image">

        <input type="number" id="id" value="0">
        <button type="button" id="focus">focus</button>
        <button type="button" id="chgColor">change color</button>
        <button type="button" id="getResult">get Result</button>
        <button type="button" id="reset">reset</button>
    </div>
    <script language="javascript" src="./resources/js/jquery-3.3.1.min.js"></script>
    <script language="javascript" src="./resources/js/jquery.canvasArea.js"></script>
    <script language="javascript" src="./resources/js/opencv.js"></script>
    <script language="javascript" src="./resources/js/magic-wand.js"></script>
    <script>
        $('#viewport').canvasAreas({
            allowEdit: true,
            allowSelect: true,
            allowGapSize: 3,
            allowZoom: true,
            onCreated: created,
            onSelected: checkSelect,
            onDeleted: deleted,
            zoomSize: 200,
            areas: []
        });

        var fileInput = document.getElementById('image');
        fileInput.addEventListener('change', function(e) {
            var files = e.target.files;
            if (files.length > 0) {
                var imgUrl = URL.createObjectURL(files[0]);
                $('#viewport').attr('data-image-url', imgUrl);
                $('#viewport').canvasAreas('reset', {
                    areas: []
                });
            }
        });

        function getRandomColor() {
            var letters = '0123456789ABCDEF';
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        $('#chgColor').click(function () {
            $('#viewport').canvasAreas('setColor', {
                id: $('#id').val(),
                color: getRandomColor()
            });
        });

        $('#focus').click(function () {
            $('#viewport').canvasAreas('focusArea', $('#id').val());
        });

        $('#getResult').click(function () {
            var result = $('#viewport').canvasAreas('areas');
            console.log(result);
        });

        $('#reset').click(function () {
            $('#viewport').attr('data-image-url',
                'https://mdn.mozillademos.org/files/4553/Capitan_Meadows,_Yosemite_National_Park.jpg');
            $('#viewport').canvasAreas('reset', {
                areas: []
            });
        });

        function created(sId) {
            console.log(sId);
        }

        function deleted(sId) {
            console.log(sId);
        }

        function checkSelect(options) {
            //console.log(options);
        }
    </script>
</body>

</html>
